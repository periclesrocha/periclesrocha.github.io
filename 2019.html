<html>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
    <head>
        <title>Average house prices for the Austin metropolitan area</title>
    </head>

    <meta name="description" content="A narrative visualization created for CS-416 at University of Illinois Urbana Champaign">
    <meta name="keywords" content="MCS-DS,CS-416, UIUC, D3, narrative visualization">
    <meta name="author" content="Peri Rocha">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="style.css">

    <body onload='init()'>
        <div class="content">
            Austin house prices... (introduction goes here)    

            <h1>Rise of house prices in Austin, TX</h1>
            <p>Paragraph 1.</p>
            <p>The mean home price in 2018 was XXXXXX. Some of the cities in the Austin metropolitan area didn't have home listings at all, according to data from this research. 
                In 2019, we start to see property prices rising with an mean increase of XXXXX when compared to 2018. More home listings are now available. 
                In 2020, suposedely due to the COVID pandemic, the housing market became a sellers market. The median sale price increased to with the region of ASDAOSIDASd averaging an incredible 1.4 M, </p>
            <div id="chart"></div>        

            <!-- CHART COMES HERE -->
            <svg width=900 height=600>
                <p>
                    <center>
                        <div class="pagination">
                            <a href="index.html">2018</a>
                            <a class="active" href="#">2019</a>
                            <a href="2020.html">2020</a>
                        </div>
                    </center>
                </p>
            </svg>
            <!-- CHART ENDS HERE -->
            
            <script>
                async function init() {
                    const data = await d3.csv("data/austinData_summary.csv");

                    var div = d3.select("body").append("div")
                        .attr("class", "tooltip")
                        .style("opacity", 0);

                    let maxPrice = data[0].Y2020;
                    
                    //console.log(maxPrice);
                    var svg = d3.select("svg"),
                        margin = 120,
                        width = svg.attr("width") - margin,
                        height = svg.attr("height") - margin;

                    var xScale = d3.scaleBand().range ([0, width]).padding(0.1),
                        yScale = d3.scaleLinear().range ([height, 0]);

                    var g = svg.append("g")
                            .attr("transform", "translate(" + 100 + "," + 100 + ")");

                    xScale.domain(data.map(function(d) { return d.City_Community; }));
                    yScale.domain([0, d3.max(data, function(d) { return d.Y2020; })]);

                    g.append("g")
                        .attr("transform", "translate(0," + height + ")")
                        .call(d3.axisBottom(xScale));

                    g.append("g")
                        .call(d3.axisLeft(yScale).tickFormat(function(d){
                            return "$" + d;
                        }).ticks(10))
                        .append("text")
                            .attr("y", 6)
                            .attr("dy", "0.71em")
                            .attr("text-anchor", "end")
                            .text("");

                            g.selectAll(".bar")
                        .data(data)
                        .enter().append("rect")
                            .attr("class", "bar")
                            .attr("x", function(d) { return xScale(d.City_Community); })
                            .attr("y", function(d) { return yScale(d.Y2019); })
                            .attr("width", xScale.bandwidth())
                            .attr("height", function(d) { return height - yScale(d.Y2019); })
                            .on("mouseover", function (d) {
                                div.style("opacity", 1)
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY) + "px")
                                    .html("Average for " + d.City_Community + " in 2018:  $" + d.Y2019.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ","));
                            })
                            .on("mouseout", function (d, i) {
                                div.style("opacity", 0);
                            })
                            .attr("fill", "#951703")
                            .attr("stroke", "#951703")
                            .text("Average sale price");

                    const annotations = [
                        {
                            note: {
                                label: "Dripping Springs has a population more than 10 times larger than Driftwood, but it also had only one house sale the next year.",
                                title: "My turn",
                                align: "left"
                            },
                            x: 436,
                            y: 126,
                            dy: -5,
                            dx: 100,
                            subject: { radius: 50, radiusPadding: 10 },
                        },
                    ];

                    const makeAnnotations = d3.annotation()
                        .type(d3.annotationLabel)
                        .annotations(annotations)

                    d3.select("svg")
                        .append("g")
                        .attr("transform", "translate(50,50)")
                        .attr("class", "annotation-group")
                        .call(makeAnnotations)
                }
            </script>        
            <p>Some other text here.</p>
        </div>
    </body>
</html>